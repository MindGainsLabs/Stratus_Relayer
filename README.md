# üöÄ Stratus Relayer Application

Bem-vindo ao **Stratus Relayer**, uma aplica√ß√£o desenvolvida em **Node.js** que permite extrair e encaminhar mensagens do Discord para o Telegram de forma autom√°tica. Este guia fornecer√° todas as etapas necess√°rias para que outra pessoa consiga implantar e executar esta aplica√ß√£o em uma **VPS Ubuntu**.

---

## üìã Sum√°rio

1. [üìå Requisitos](#-requisitos)
2. [üîß Configura√ß√£o da VPS Ubuntu](#-configura√ß√£o-da-vps-ubuntu)
3. [üíª Instala√ß√£o das Ferramentas Necess√°rias](#-instala√ß√£o-das-ferramentas-necess√°rias)
   - [1. Instalar Node.js](#1-instalar-nodejs)
   - [2. Instalar MongoDB](#2-instalar-mongodb)
   - [3. Instalar Git](#3-instalar-git)
4. [üì• Clonar o Reposit√≥rio](#-clonar-o-reposit√≥rio)
5. [‚öôÔ∏è Configurar Vari√°veis de Ambiente](#-configurar-vari√°veis-de-ambiente)
   - [Criar e Configurar o Arquivo `.env`](#criar-e-configurar-o-arquivo-env)
6. [üì¶ Instalar Depend√™ncias](#-instalar-depend√™ncias)
   - [Instalar Depend√™ncias Node.js](#instalar-depend√™ncias-nodejs)
7. [üîê Configura√ß√£o dos Bots Discord e Telegram](#-configura√ß√£o-dos-bots-discord-e-telegram)
   - [A. Configurar Bot no Discord](#a-configurar-bot-no-discord)
   - [B. Configurar Bot no Telegram](#b-configurar-bot-no-telegram)
8. [üöÄ Executar a Aplica√ß√£o](#-executar-a-aplica√ß√£o)
9. [üîÑ Configurar a Aplica√ß√£o para Iniciar Automaticamente](#-configurar-a-aplica√ß√£o-para-iniciar-automaticamente)
   - [Usando o PM2](#usando-o-pm2)
10. [üõ°Ô∏è Configurar Firewall](#-configurar-firewall)
11. [‚úÖ Testar a Implanta√ß√£o](#-testar-a-implanta√ß√£o)
12. [üìù Manuten√ß√£o e Dicas Adicionais](#-manuten√ß√£o-e-dicas-adicionais)
13. [üìö Recursos Adicionais](#-recursos-adicionais)
14. [üîó Links √öteis](#-links-√∫teis)
15. [üìú Descri√ß√£o](#-descri√ß√£o)
16. [üõ†Ô∏è Tecnologias Utilizadas](#%EF%B8%8F-tecnologias-utilizadas)
17. [üìã Funcionalidades](#-funcionalidades)
18. [üìú Responsabilidades](#-responsabilidades)
19. [üìÇ Estrutura do Projeto](#-estrutura-do-projeto)
20. [üîó Integra√ß√µes](#-integra√ß√µes)

---

## üìå Requisitos

Antes de iniciar, certifique-se de que voc√™ possui:

- **Acesso a uma VPS Ubuntu** com privil√©gios administrativos.
- **Conta no Discord** e **Bot Token**.
- **Conta no Telegram** e **Bot Token**.
- **Conhecimento b√°sico** em linha de comando e configura√ß√£o de servi√ßos no Linux.

---

## üîß Configura√ß√£o da VPS Ubuntu

### 1. Acesso √† VPS

- **SSH (Secure Shell):**
  - Use o **SSH** para acessar sua VPS.
  - Abra o terminal no seu computador local e insira o comando:
    ```bash
    ssh usuario@ip_da_vps
    ```
  - Substitua `usuario` pelo seu nome de usu√°rio na VPS e `ip_da_vps` pelo endere√ßo IP da VPS.

### 2. Atualiza√ß√£o do Sistema

- **Atualize o Ubuntu:**
  - Execute os seguintes comandos para atualizar os pacotes do sistema:
    ```bash
    sudo apt update
    sudo apt upgrade -y
    ```

---

## üíª Instala√ß√£o das Ferramentas Necess√°rias

### 1. Instalar Node.js

1. **Adicionar o Reposit√≥rio NodeSource:**
   ```bash
   curl -fsSL https://deb.nodesource.com/setup_16.x | sudo -E bash -
   ```

2. **Instalar Node.js:**
   ```bash
   sudo apt install -y nodejs
   ```

3. **Verificar Instala√ß√£o:**
   ```bash
   node -v
   npm -v
   ```

### 2. Instalar MongoDB

1. **Importar a Chave P√∫blica do MongoDB:**
   ```bash
   wget -qO - https://www.mongodb.org/static/pgp/server-4.4.asc | sudo apt-key add -
   ```

2. **Criar o Arquivo de Lista do MongoDB:**
   ```bash
   echo "deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu focal/mongodb-org/4.4 multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-4.4.list
   ```

3. **Atualizar os Pacotes do Sistema:**
   ```bash
   sudo apt update
   ```

4. **Instalar o MongoDB:**
   ```bash
   sudo apt install -y mongodb-org
   ```

5. **Iniciar o MongoDB:**
   ```bash
   sudo systemctl start mongod
   sudo systemctl enable mongod
   ```

6. **Verificar Instala√ß√£o:**
   ```bash
   mongo --version
   ```

### 3. Instalar Git

1. **Instalar Git:**
   ```bash
   sudo apt install -y git
   ```

2. **Verificar Instala√ß√£o:**
   ```bash
   git --version
   ```

---

## üì• Clonar o Reposit√≥rio

1. **Navegar at√© o Diret√≥rio Desejado:**
   ```bash
   cd /caminho/para/diretorio
   ```

2. **Clonar o Reposit√≥rio:**
   ```bash
   git clone https://github.com/usuario/repo-Stratus_Relayer.git
   cd repo-Stratus_Relayer/Relay_Stratus
   ```

---

## ‚öôÔ∏è Configurar Vari√°veis de Ambiente

### Criar e Configurar o Arquivo `.env`

1. **Criar o Arquivo `.env`:**
   ```bash
   nano .env
   ```

2. **Adicionar as Vari√°veis ao `.env`:**
   ```env
   # MongoDB Configuration
   MONGO_URI=mongodb://localhost:27017/scrapping-tweets-smarteye

   # Discord API Credentials
   TOKEN_DISCORD=seu_token_discord
   CHANNEL_ID=123456789012345678

   # Telegram Bot Configuration
   TELEGRAM_BOT_TOKEN=seu_telegram_bot_token
   TELEGRAM_CHAT_ID=987654321

   # Cron Job Configuration
   CRON_SCHEDULE=*/2 * * * * *
   CRON_HOURS=6

   # Servidor
   PORT=80
   ```

   **Descri√ß√£o das Vari√°veis:**

   - **MONGO_URI:** URI de conex√£o com o MongoDB.
   - **TOKEN_DISCORD:** Token do seu bot Discord.
   - **CHANNEL_ID:** ID do canal Discord de onde as mensagens ser√£o extra√≠das.
   - **TELEGRAM_BOT_TOKEN:** Token do seu bot Telegram.
   - **TELEGRAM_CHAT_ID:** ID do chat Telegram para onde as mensagens ser√£o enviadas.
   - **CRON_SCHEDULE:** Express√£o cron para agendamento da coleta de mensagens (por padr√£o, a cada 30 segundos).
   - **CRON_HOURS:** N√∫mero de horas para retroceder ao coletar mensagens.
   - **PORT:** Porta onde o servidor Node.js ir√° rodar (80 para HTTP padr√£o).

   **Exemplo Completo de `.env`:**
   ```env
   # MongoDB Configuration
   MONGO_URI=mongodb://localhost:27017/scrapping-tweets-smarteye

   # Discord API Credentials
   TOKEN_DISCORD=ODk5MDM3NjA1NTkzOTYw.YGmGgQ.QjzU9OgZrD4zm0YQ0i3mfxqwHSE
   CHANNEL_ID=123456789012345678

   # Telegram Bot Configuration
   TELEGRAM_BOT_TOKEN=123456789:ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890
   TELEGRAM_CHAT_ID=987654321

   # Cron Job Configuration
   CRON_SCHEDULE=*/2 * * * * *
   CRON_HOURS=6

   # Servidor
   PORT=80
   ```

   **Notas:**

   - **Seguran√ßa:** Garanta que este arquivo `.env` **n√£o seja compartilhado** ou versionado no controle de vers√£o p√∫blico, pois cont√©m credenciais sens√≠veis.
   - **Formata√ß√£o:** Certifique-se de que n√£o haja espa√ßos adicionais e que os valores estejam corretos.

---

## üì¶ Instalar Depend√™ncias

### Instalar Depend√™ncias Node.js

1. **Navegar at√© o Diret√≥rio Node.js:**
   ```bash
   cd /caminho/para/repo-Stratus_Relayer/Relay_Stratus
   ```

2. **Instalar Depend√™ncias:**
   ```bash
   npm install
   ```
   
   **Nota:**
   - Certifique-se de que o arquivo `package.json` est√° corretamente configurado com todas as depend√™ncias necess√°rias.

3. **Verificar Depend√™ncias Instaladas:**
   - Ap√≥s a instala√ß√£o, uma pasta `node_modules` deve existir dentro de Relay_Stratus.

---

## üîê Configura√ß√£o dos Bots Discord e Telegram

### A. Configurar Bot no Discord

1. **Criar um Bot no Discord:**
   - Acesse o [Discord Developer Portal](https://discord.com/developers/applications).
   - Clique em **"New Application"** e d√™ um nome para o seu aplicativo.
   
2. **Obter o Token do Bot:**
   - No menu lateral, v√° para **"Bot"**.
   - Clique em **"Add Bot"** e confirme.
   - Em **"TOKEN"**, clique em **"Copy"** para obter o Token do Bot. **Guarde-o com seguran√ßa**.

3. **Convidar o Bot para seu Servidor:**
   - Ainda no Developer Portal, v√° para **"OAuth2"** > **"URL Generator"**.
   - Em **"Scopes"**, selecione **"bot"**.
   - Em **"Bot Permissions"**, selecione as permiss√µes necess√°rias (por exemplo, **"Read Messages"**, **"Send Messages"**, etc.).
   - Copie a URL gerada e abra-a no navegador para convidar o bot ao seu servidor.

4. **Obter o ID do Canal Discord:**
   - No Discord, ative o **"Modo de Desenvolvedor"** em **Configura√ß√µes** > **Avan√ßado** > **Modo de Desenvolvedor**.
   - Clique com o bot√£o direito no canal desejado e selecione **"Copiar ID"** para obter o `CHANNEL_ID`.

### B. Configurar Bot no Telegram

1. **Criar um Bot no Telegram:**
   - Abra o Telegram e inicie uma conversa com o [BotFather](https://t.me/BotFather).
   - Envie o comando `/newbot` e siga as instru√ß√µes para criar um novo bot.
   - Ap√≥s a cria√ß√£o, o BotFather fornecer√° um **Token de API** para o bot. **Guarde-o com seguran√ßa**.

2. **Obter o Chat ID do Telegram:**
   - Inicie uma conversa com o seu bot Telegram.
   - Envie uma mensagem qualquer.
   - Para obter o `TELEGRAM_CHAT_ID`, voc√™ pode usar a API do Telegram ou ferramentas como [Get IDs](https://getids.xyz/):

     - Abra a URL:
       ```
       https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getUpdates
       ```
       Substitua `<YOUR_BOT_TOKEN>` pelo token do seu bot.
     - Encontre o `chat.id` na resposta JSON.

---

## üöÄ Executar a Aplica√ß√£o

1. **Navegar at√© o Diret√≥rio Node.js:**
   ```bash
   cd /caminho/para/repo-Stratus_Relayer/Relay_Stratus
   ```

2. **Iniciar a Aplica√ß√£o:**
   ```bash
   npm run start
   ```
   
   - **Alternativamente**, execute diretamente com Node.js:
     ```bash
     node index.js
     ```

   - **Sa√≠da Esperada:**
     ```
     Conectado ao MongoDB
     Cron job agendado com a seguinte express√£o: "*/2 * * * * *"
     Servidor rodando em http://localhost:80
     ```

3. **Acessar a Interface Web:**
   - Abra um navegador e v√° para `http://<IP_DA_SUA_VPS>`.
   - A p√°gina **"Extrator de Mensagens Discord"** deve ser exibida.

---

## üîÑ Configurar a Aplica√ß√£o para Iniciar Automaticamente

### Usando o PM2

O **PM2** permite executar aplica√ß√µes Node.js como servi√ßos no Linux, garantindo que a aplica√ß√£o inicie automaticamente com o sistema.

1. **Instalar o PM2:**
   ```bash
   sudo npm install -g pm2
   ```

2. **Iniciar a Aplica√ß√£o com o PM2:**
   ```bash
   pm2 start index.js --name Stratus_Relayer
   ```

3. **Configurar o PM2 para Iniciar na Inicializa√ß√£o do Sistema:**
   ```bash
   pm2 startup systemd
   ```

4. **Salvar o Estado Atual do PM2:**
   ```bash
   pm2 save
   ```

5. **Verificar o Status do PM2:**
   ```bash
   pm2 status
   ```

---

## üõ°Ô∏è Configurar Firewall

Para que a aplica√ß√£o seja acess√≠vel externamente, √© necess√°rio garantir que as portas utilizadas estejam abertas.

### Passo a Passo

1. **Abrir Porta no Firewall do Ubuntu:**

   - **Usar UFW (Uncomplicated Firewall):**
     ```bash
     sudo ufw allow 80/tcp
     sudo ufw enable
     sudo ufw status
     ```

2. **Verificar a Conex√£o:**

   - Acesse `http://<IP_DA_SUA_VPS>:80` no navegador para verificar se o servidor est√° rodando.
   - **Substitua** `<IP_DA_SUA_VPS>` pelo endere√ßo IP da sua VPS.

---

## ‚úÖ Testar a Implanta√ß√£o

Ap√≥s configurar e iniciar a aplica√ß√£o, voc√™ pode testar a implanta√ß√£o verificando se as mensagens est√£o sendo extra√≠das corretamente dos canais do Discord e se as notifica√ß√µes est√£o sendo enviadas para o Telegram. Verifique os logs da aplica√ß√£o para garantir que n√£o h√° erros e que todas as funcionalidades est√£o operando conforme esperado.

---

## üìù Manuten√ß√£o e Dicas Adicionais

- **Atualiza√ß√µes de Depend√™ncias**: Mantenha as depend√™ncias do projeto atualizadas para garantir a seguran√ßa e a estabilidade da aplica√ß√£o.
- **Monitoramento**: Implemente monitoramento e alertas para acompanhar a sa√∫de da aplica√ß√£o e detectar problemas rapidamente.
- **Backups**: Realize backups regulares do banco de dados para evitar perda de dados.

---

## üìö Recursos Adicionais

- **Documenta√ß√£o do Discord API**: [Discord Developer Portal](https://discord.com/developers/docs/intro)
- **Documenta√ß√£o do Rugcheck API**: [Rugcheck API Documentation](https://api.rugcheck.xyz/docs)
- **Documenta√ß√£o do Telegram API**: [Telegram Bot API](https://core.telegram.org/bots/api)

---

## üîó Links √öteis

- **Node.js**: [Node.js Official Website](https://nodejs.org/)
- **Express**: [Express Official Website](https://expressjs.com/)
- **Mongoose**: [Mongoose Official Website](https://mongoosejs.com/)
- **Axios**: [Axios GitHub Repository](https://github.com/axios/axios)
- **dotenv**: [dotenv GitHub Repository](https://github.com/motdotla/dotenv)
- **tweetnacl**: [tweetnacl GitHub Repository](https://github.com/dchest/tweetnacl-js)
- **tweetnacl-util**: [tweetnacl-util GitHub Repository](https://github.com/dchest/tweetnacl-util-js)

---

## üìú Descri√ß√£o

O Stratus Relayer Application √© uma aplica√ß√£o desenvolvida para extrair mensagens de canais do Discord e realizar an√°lises e verifica√ß√µes utilizando diversas APIs e servi√ßos. A aplica√ß√£o √© capaz de autenticar, buscar relat√≥rios e enviar notifica√ß√µes para o Telegram.

---

## üõ†Ô∏è Tecnologias Utilizadas

- **Node.js**: Plataforma de desenvolvimento JavaScript.
- **Express**: Framework para constru√ß√£o de APIs.
- **Axios**: Cliente HTTP para realizar requisi√ß√µes.
- **Mongoose**: Biblioteca para modelagem de dados MongoDB.
- **dotenv**: Gerenciamento de vari√°veis de ambiente.
- **tweetnacl**: Biblioteca para criptografia e assinatura de mensagens.
- **tweetnacl-util**: Utilit√°rios para codifica√ß√£o e decodifica√ß√£o de dados na biblioteca `tweetnacl`.

---

## üìã Funcionalidades

- **Extra√ß√£o de Mensagens**: Extrai mensagens de canais do Discord em um per√≠odo de tempo especificado.
- **Autentica√ß√£o**: Autentica na API do Rugcheck para obter relat√≥rios de tokens.
- **An√°lise de Tokens**: Busca relat√≥rios de tokens utilizando a API do Rugcheck.
- **Notifica√ß√µes**: Envia notifica√ß√µes para o Telegram com as mensagens extra√≠das e analisadas.
- **Armazenamento**: Armazena mensagens extra√≠das no MongoDB.

---

## üìú Responsabilidades

- **messageService.js**: Respons√°vel por extrair mensagens dos canais do Discord e realizar an√°lises.
- **rugcheckService.js**: Respons√°vel por autenticar e buscar relat√≥rios de tokens na API do Rugcheck.
- **telegramService.js**: Respons√°vel por enviar notifica√ß√µes para o Telegram.
- **server.js**: Inicializa o servidor e configura as rotas da API.

---

## üìÇ Estrutura do Projeto

```
/Relay_Stratus
‚îú‚îÄ‚îÄ public
‚îÇ   ‚îú‚îÄ‚îÄ css
‚îÇ   ‚îú‚îÄ‚îÄ js
‚îÇ   ‚îî‚îÄ‚îÄ index.html
‚îú‚îÄ‚îÄ src
‚îÇ   ‚îú‚îÄ‚îÄ controllers
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ messageController.js
‚îÇ   ‚îú‚îÄ‚îÄ models
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Message.js
‚îÇ   ‚îú‚îÄ‚îÄ routes
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ messageRoutes.js
‚îÇ   ‚îú‚îÄ‚îÄ services
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ messageService.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ rugcheckService.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ telegramService.js
‚îÇ   ‚îú‚îÄ‚îÄ utils
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ formatter.js
‚îÇ   ‚îî‚îÄ‚îÄ server.js
‚îú‚îÄ‚îÄ .env
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ package.json
‚îî‚îÄ‚îÄ README.md
```

## üîó Integra√ß√µes

- **Discord API**: Utilizada para extrair mensagens dos canais do Discord.
- **Rugcheck API**: Utilizada para autenticar e buscar relat√≥rios de tokens.
- **Telegram API**: Utilizada para enviar notifica√ß√µes com as mensagens extra√≠das e analisadas.

## Depend√™ncias

- **axios**: ^0.21.1
- **dotenv**: ^8.2.0
- **express**: ^4.17.1
- **mongoose**: ^5.10.9
- **tweetnacl**: ^1.0.3
- **tweetnacl-util**: ^0.15.1

## Configura√ß√£o

1. Clone o reposit√≥rio:
    ```bash
    git clone https://github.com/seu-usuario/scrapping-tweets-smarteye.git
    cd scrapping-tweets-smarteye/Relay_Stratus
    ```

2. Instale as depend√™ncias:
    ```bash
    npm install
    ```

3. Configure as vari√°veis de ambiente no arquivo env`.`:
    ```env
    TOKEN_DISCORD=SeuTokenDiscordAqui
    RUGCHECK_API_URL=https://api.rugcheck.xyz
    RUGCHECK_TOKEN_ID=SuaChavePublicaAqui
    RUGCHECK_SECRET_KEY=SuaChavePrivadaAqui
    TELEGRAM_BOT_TOKEN=SeuTokenTelegramBotAqui
    TELEGRAM_CHAT_ID=SeuChatIdTelegramAqui
    MONGODB_URI=SuaURIConexaoMongoDBAqui
    CHANNEL_ID_1=IDDoCanal1
    CHANNEL_ID_2=IDDoCanal2
    CHANNEL_ID_3=IDDoCanal3
    ```

4. Inicie a aplica√ß√£o:
    ```bash
    npm start
    ```

## Uso

A aplica√ß√£o ir√° extrair mensagens dos canais do Discord configurados, analisar os tokens mencionados nas mensagens utilizando a API do Rugcheck, e enviar notifica√ß√µes para o Telegram com os resultados das an√°lises.

## Licen√ßa

Este projeto est√° licenciado sob a licen√ßa MIT. Veja o arquivo LICENSE para mais detalhes.